var map=L.map("map",{minZoom:0,maxZoom:18,zoomSnap:0,zoomDelta:.25}).setView([0,0],0);map.on("contextmenu",function(a){draw_area(a),update_flights()}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png").addTo(map);var flight_data,trackingArea=null,flight_layergroup=null,plane_flying=L.icon({iconUrl:"plane_fly.PNG",iconSize:[43,45],iconAnchor:[21,22]}),plane_grounded=L.icon({iconUrl:"plane_grounded.PNG",iconSize:[43,45],iconAnchor:[21,22]}),myHeaders=new Headers;myHeaders.append("Authorization","Basic Y2thOlN0b25lZDEyMzQs"),myHeaders.append("Cookie","XSRF-TOKEN=6541dea4-0434-4d10-b6cd-12c7af32a8df");var requestOptions={method:"GET",headers:myHeaders,redirect:"follow"};L.marker([52.178928,10.559365]).addTo(map).bindTooltip("<b>Ostfalia</b>",{permanent:!0,direction:"right",opacity:.6});function clear_flights(){flight_layergroup.removeFrom(map)}function update_flights(){setInterval(()=>{draw_flights()},5000)}function draw_flights(){let a=get_data();Promise.all([a]).then(a=>{var b,c,d=[];for(i=0;i<a[0].states.length;i++)c=a[0].states[i][1],latitude=a[0].states[i][6],longitude=a[0].states[i][5],true_track=a[0].states[i][10],on_ground=a[0].states[i][8],on_ground||(b=L.marker([latitude,longitude],{icon:plane_flying,rotationAngle:true_track}).bindTooltip(c,{permanent:!0,direction:"right",opacity:.8})),d[i]=b;null==flight_layergroup?flight_layergroup=L.layerGroup(d).addTo(map):(clear_flights(),flight_layergroup=L.layerGroup(d).addTo(map))})}function draw_area(a){null!=flight_layergroup&&clear_flights();var b,c;b=a.latlng.lat,c=a.latlng.lng,null==trackingArea?trackingArea=L.circle([b,c],{color:"red",stroke:!1,fillColor:"#f03",fillOpacity:.05,radius:4e5}).addTo(map):trackingArea.setLatLng([b,c])}function get_data(){var a=trackingArea.getBounds()._southWest.lat,b=trackingArea.getBounds()._northEast.lat,c=trackingArea.getBounds()._southWest.lng,d=trackingArea.getBounds()._northEast.lng;return fetch("https://opensky-network.org/api/states/all?lamin="+a+"&lomin="+c+"&lamax="+b+"&lomax="+d,requestOptions).then(async a=>{var b=await a.json();return b})}